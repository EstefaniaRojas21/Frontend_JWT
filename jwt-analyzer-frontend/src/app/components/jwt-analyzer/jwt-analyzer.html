<div class="left-panel">
  
<section class="card analyzer-card">

  <h2 class="section-title">üîç Analizador de JWT</h2>
  <!-- Bot√≥n Historial -->

  <div class="top-right">
    <button class="btn history-btn" (click)="toggleHistory()">Historial</button>
  </div>

  <!-- Ventana emergente de historial -->
<div class="history-modal" *ngIf="showHistory()">
  <div class="history-content">
    <button class="close-x" (click)="showHistory.set(false)">√ó</button>
    <h3>Historial de Tokens</h3>
    <table class="history-table">
      <thead>
        <tr>
          <th>Descripci√≥n</th>
          <th>Token</th>
          <th>Acci√≥n</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of historyData()">
          <td>{{item.descripcion}}</td>
          <td class="token-cell">{{item.token}}</td>
          <td>
            <button class="copy-btn" (click)="copyToClipboard(item.token)">Copiar</button>
          </td>
        </tr>
      </tbody>
    </table>
    <button class="close-btn" (click)="showHistory.set(false)">Cerrar</button>
    
  </div>
</div>




  <!-- Campo principal -->
  <label class="label">Token JWT</label>
  <textarea
    rows="4"
    placeholder="Pega tu JWT aqu√≠..."
    class="input-mono"
    [(ngModel)]="jwtText"
  ></textarea>

 <label class="label small">Clave para verificar (opcional)</label>
  <input
    id="secretInput"
    type="text"
    class="input-mono"
    placeholder="Secret o public key PEM"
  />


  <div class="main-actions">
    <button
      class="btn analyze-blue"
      (click)="analizarToken()"
      [disabled]="loading()"
    >
      <span *ngIf="!loading()">Analizar Token</span>
      <span *ngIf="loading()">‚è≥ Procesando...</span>
    </button>

    <button
      class="btn validate-green"
      (click)="validarFirma()"
      [disabled]="loading()"
    >
      Validar Firma
    </button>
  </div>


  <div class="phase-box">
    <button
      class="btn phase-menu-btn"
      (click)="showDetails.set(!showDetails())"
    >
      Analizar por Fase ‚ñæ
    </button>

    <div class="phase-options" *ngIf="showDetails()">
      <button (click)="analizarFase('lexico')" class="phase-option">
        üü¶ An√°lisis L√©xico
      </button>

      <button (click)="analizarFase('sintactico')" class="phase-option">
        üü© An√°lisis Sint√°ctico
      </button>

      <button (click)="analizarFase('semantico')" class="phase-option">
        üü® An√°lisis Sem√°ntico
      </button>
    </div>
  </div>

  <!-- ‚úÖ Mensajes -->
  <div *ngIf="error()" class="error-box">{{ error() }}</div>

  <!-- ‚úÖ Panel Resumen -->
  <div *ngIf="analyzedSummary" class="summary-panel">
    <app-output-panel
      [data]="analyzedData()?.payload_decodificado"
      title="Resumen del Payload"
    ></app-output-panel>
  </div>

  <div *ngIf="analyzedSummary" class="summary-panel">
    <app-output-panel
      [data]="analyzedData()?.header_decodificado"
      title="Resumen del Header"
    ></app-output-panel>
  </div>

  <!-- ‚úÖ Salida Completa 
  <section class="container output-wide" *ngIf="analyzedData()">
    <div class="card detailed-card">
      <h3 class="card-title">Salida detallada</h3>
      <pre class="result-area">{{ analyzedData() | json }}</pre>
    </div>
  </section>
-->
</section>


<app-lexical-modal
  *ngIf="showModal()"
  [currentPhase]="activePhase()"
  [result]="phaseResults()[activePhase()]"
  (closed)="showModal.set(false)"
  (phaseChanged)="onPhaseChanged($event)"
></app-lexical-modal>





</div>
